<html>
	<head>
		<title>FreewayData</title>
		<link href="/static/style.css" rel="stylesheet" type="text/css"/>
		<script src="/mapreduce/jquery.js" type="text/javascript"></script>
		<script src="/static/custom.js" type="text/javascript"></script>
	</head>
	<body>
		<div>
			<!-- File upload form -->
			<form action="{{ upload_url }}" method="post"
				enctype="multipart/form-data">
				<h3>Upload files to the Blobstore</h3>
				<label for="file">Filename:</label>
				<input type="file" name="file" id="file"/>
				<br>
				<input type="submit" name="submit" value="Upload"/>
			</form>
			<hr>
			<!-- Display uploaded files, and allow for import into Datastore -->
			<div>
				<h3>Import files from Blobstore to Datastore</h3>
				<p>highways.csv, freeway_stations.csv, and freeway_detectors.csv can be imported to Datastore</p>
				{% if file_count %}
				<table border=1>
					<tr>
						<th></th>
						<th>name</th>
						<th>uploaded on</th>
						<th>content type</th>
						<th>md5</th>
						<th>blobkey</th>
						<th>size</th>
					</tr>
					{% for file in files %}
					<tr>
						<td><input type="radio" name="file_radio" onclick="updateImportForm('{{ file.blobkey }}','{{ file.blobkey }}','{{ file.filename }}');"></td>
						<td><a href="/file/{{ file.blobkey }}/download">{{ file.filename }}</a></td>
						<td>{{ file.creation }}</td>
						<td>{{ file.content_type }}</td>
						<td>{{ file.md5_hash }}</td>
						<td>{{ file.blobkey }}</td>
						<td>{{ file.size }}</td>
					</tr>
					{% endfor %}
				</table>
				<br>
				<form action="/import" method="post">
					Input File: <label id="fileName">none selected</label>
					<input type="hidden" name="filekey" id="filekey" value=""/>
					<input type="hidden" name="blobkey" id="blobkey" value=""/>
					<br/>
					<input type="submit" id="import" name="import" value="Import" disabled="true"/>
				</form>
				{% else %}
				<div>No files uploaded yet!</div>
				{% endif %}
			</div>
			<hr/>
			<h3>View Datastore entities</h3>
			<p>Highway, Station, and Detector data stored in Datastore</p>
			<!-- Highways Datastore entities table -->
			<div>
				{% if hwys_count %}
				<h4>Highways</h4>
				<table border=1>
					<tr>
						<th>highwayid</td>
						<th>highwayname</th>
						<th>direction</th>
						<th>shortdirection</th>
						<th>stations</th>
					</tr>
					{% for highway in highways %}
					<tr>
						<td>{{ highway.highwayid }}</td>
						<td>{{ highway.highwayname }} </td>
						<td>{{ highway.direction }}</td>
						<td>{{ highway.shortdirection }}</td>
						<td>{{ highway.stations }}</td>
					{% endfor %}
					</tr>
				</table>
				{% else %}
				No highways found - upload highways.csv and perform import above.
				{% endif %}
			</div>
			<!-- Stations Datastore entities table -->
			<div>
				{% if stns_count %}
				<h4>Stations</h4>
				<table border=1>
					<tr>
						<th>stationid</td>
						<th>highwayid</th>
						<th>milepost</th>
						<th>locationtext</th>
						<th>upstream</th>
						<th>downstream</th>
						<th>stationclass</th>
						<th>numberlanes</th>
						<th>latlon</th>
						<th>length_mid</th>
						<th>detectors</th>
					</tr>
					{% for station in stations %}
					<tr>
						<td>{{ station.stationid }}</td>
						<td>{{ station.highwayid }} </td>
						<td>{{ station.milepost }}</td>
						<td>{{ station.locationtext }}</td>
						<td>{{ station.upstream }}</td>
						<td>{{ station.downstream }}</td>
						<td>{{ station.stationclass }}</td>
						<td>{{ station.numberlanes }}</td>
						<td>{{ station.latlon }}</td>
						<td>{{ station.length_mid }}</td>
						{% if station.detectors %}
						<td>
						{% for detector in station.detectors %}
						{{ detector.detectorid }}
						{% endfor %}
						</td>
						{% endif %}
					{% endfor %}
					</tr>
				</table>
				{% else %}
				No stations found - upload freeway_stations.csv and perform import above</a>.
				{% endif %}
			</div>
		</div>
		<hr/>
	</body>
</html>
